<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Thesis Progress Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-white">
  <div id="root"></div>
  <script type="text/babel">

function App() {
  const [progress, setProgress] = React.useState(35);
  const [commits, setCommits] = React.useState([]);
  const [commitGrid, setCommitGrid] = React.useState([]); // 10 days x 24 hours
  const [messages, setMessages] = React.useState([]);
  const [showCommits, setShowCommits] = React.useState(false);
  const [loading, setLoading] = React.useState(false);
  const [currentTranslation, setCurrentTranslation] = React.useState(0);
  const [showCelebration, setShowCelebration] = React.useState(false);
  const [currentQuote, setCurrentQuote] = React.useState(0);
  const [showAdmin, setShowAdmin] = React.useState(false);
  const [showSupervisor, setShowSupervisor] = React.useState(false);
  const [expandedCell, setExpandedCell] = React.useState(null); // {day, hour}
  const [refreshing, setRefreshing] = React.useState(false);

  // Robot translations in different languages
  const translations = [
    { text: "Hello! Good luck with your thesis!", lang: "English", emoji: "üòä" },
    { text: "¬°Hola! ¬°Buena suerte con tu tesis!", lang: "Spanish", emoji: "ü§ó" },
    { text: "ÿ≥ŸÑÿßŸÖ! ÿ¢Ÿæ ⁄©€í ŸÖŸÇÿßŸÑ€í ⁄©€í ŸÑ€å€í ŸÜ€å⁄© ÿ™ŸÖŸÜÿßÿ¶€å⁄∫!", lang: "Urdu", emoji: "üòÑ" },
    { text: "ÿ≥ŸÑÿßŸÖ Ÿàÿ±Ÿàÿ±Ÿá! ÿ≥ÿ™ÿßÿ≥Ÿà ÿØ ÿ™€åÿ≤ÿ≥ ŸÑŸæÿßÿ±Ÿá ⁄öŸá Ÿæÿßÿ™€ê ÿ±ÿßÿ∫Ÿàÿß⁄ìŸÖ!", lang: "Pashto", emoji: "üöÄ" }
  ];

  // NLP/AI Quotes and Memes
  const nlpQuotes = [
    "\"The best way to predict the future is to invent it.\" - Alan Kay",
    "\"Machine learning is the last invention that humanity will ever need to make.\" - Nick Bostrom",
    "\"Data is the new oil, but machine learning is the refinery.\" - Anonymous",
    "\"In God we trust, all others must bring data.\" - W. Edwards Deming",
    "\"Artificial intelligence is the new electricity.\" - Andrew Ng",
    "\"The goal is to turn data into information, and information into insight.\" - Carly Fiorina",
    "\"Deep learning is not just a trend, it's a revolution.\" - Yann LeCun",
    "\"Natural Language Processing: Teaching machines to understand humans, one word at a time.\"",
    "\"Overfitting: When your model knows the training data better than you know yourself.\"",
    "\"Debugging ML models: 99% data issues, 1% actual algorithm problems.\""
  ];

  // Fetch progress from backend
  const fetchProgress = async () => {
    try {
      // Replace with your actual backend URL if not running locally
      const response = await fetch('http://localhost:5000/api/progress');
      const data = await response.json();
      const newProgress = data.progress || 0;
      if (newProgress > progress && newProgress % 10 === 0) {
        setShowCelebration(true);
        setTimeout(() => setShowCelebration(false), 3000);
      }
      setProgress(newProgress);
    } catch (error) {
      setProgress(45);
    }
  };

  // Fetch messages from backend
  const fetchMessages = async () => {
    try {
      const response = await fetch('http://localhost:5000/api/messages');
      const data = await response.json();
      setMessages(data.messages || []);
    } catch (error) {
      setMessages([
        { id: 1, text: "Started data collection phase", author: "Faizan", timestamp: "2025-01-15" },
        { id: 2, text: "Completed literature review", author: "Supervisor", timestamp: "2025-01-10" }
      ]);
    }
  };

  // Fetch GitHub commits and build commit grid
  const fetchCommits = async () => {
    setLoading(true);
    try {
      // Get last 10 days of commits by phaze7r
      const since = new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString();
      const url = `https://api.github.com/repos/phaze7r/geospatial-tagging-thesis/commits?author=phaze7r&since=${since}&per_page=100`;
      const response = await fetch(url);
      const data = await response.json();
      setCommits(data);
      // Build grid: 10 days x 24 hours
      const grid = Array.from({ length: 10 }, (_, d) => Array(24).fill([]));
      data.forEach(commit => {
        const date = new Date(commit.commit.author.date);
        const now = new Date();
        const dayDiff = Math.floor((now - date) / (24 * 60 * 60 * 1000));
        if (dayDiff < 10) {
          const hour = date.getHours();
          const dayIdx = 9 - dayDiff; // 0 = oldest, 9 = today
          if (!Array.isArray(grid[dayIdx][hour])) grid[dayIdx][hour] = [];
          grid[dayIdx][hour] = [...grid[dayIdx][hour], commit];
        }
      });
      setCommitGrid(grid);
      setShowCommits(true);
    } catch (error) {
      setCommits([]);
      setCommitGrid([]);
    }
    setLoading(false);
  };

  // Manual refresh
  const handleRefresh = async () => {
    setRefreshing(true);
    await fetchProgress();
    await fetchMessages();
    await fetchCommits();
    setRefreshing(false);
  };

  // Get inspirational message based on progress
  const getInspirationMessage = (progress) => {
    if (progress < 20) return "üå± Every great journey begins with a single step!";
    if (progress < 40) return "üöÄ Building momentum - your research is taking shape!";
    if (progress < 60) return "üí° Halfway there! Your insights are illuminating new paths!";
    if (progress < 80) return "‚ö° Excellence in progress - the finish line is in sight!";
    return "üéØ Almost there! Your contribution to geospatial AI will be remarkable!";
  };

  // Rotate translations every 4 seconds
  React.useEffect(() => {
    const interval = setInterval(() => {
      setCurrentTranslation((prev) => (prev + 1) % translations.length);
    }, 4000);
    return () => clearInterval(interval);
  }, []);

  // Rotate quotes every 8 seconds
  React.useEffect(() => {
    const interval = setInterval(() => {
      setCurrentQuote((prev) => (prev + 1) % nlpQuotes.length);
    }, 8000);
    return () => clearInterval(interval);
  }, []);

  // Fetch data on component mount
  React.useEffect(() => {
    fetchProgress();
    fetchMessages();
    fetchCommits();
    // Refresh progress every 5 minutes
    const interval = setInterval(fetchProgress, 300000);
    return () => clearInterval(interval);
  }, []);

  // Color scale for commit grid (sunset orange palette)
  const getCellColor = (count) => {
    if (count === 0) return "#f3f4f6"; // light gray
    if (count === 1) return "#ffe5b4"; // light orange
    if (count === 2) return "#ffb347"; // medium orange
    if (count === 3) return "#ff7f50"; // coral
    if (count >= 4) return "#ff6b35"; // deep orange
    return "#f3f4f6";
  };

  // Day labels (last 10 days)
  const getDayLabels = () => {
    const days = [];
    for (let i = 9; i >= 0; i--) {
      const d = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
      days.push(d.toLocaleDateString(undefined, { month: 'short', day: 'numeric' }));
    }
    return days;
  };

  return (
    <div className="min-h-screen bg-white">
      {/* Celebration Animation */}
      {showCelebration && (
        <div className="fixed inset-0 pointer-events-none z-50 flex items-center justify-center">
          <div className="text-6xl animate-bounce">üéâ</div>
          <div className="absolute inset-0 bg-gradient-to-r from-orange-400 to-yellow-400 opacity-20 animate-pulse"></div>
        </div>
      )}

      {/* Header */}
      <header className="bg-white flex items-center justify-between px-6 py-6">
        <div>
          <h1 className="text-4xl font-black text-black mb-1">
            Geospatial Tagging Thesis Progress
          </h1>
          <p className="text-lg text-gray-700 font-bold">
            Bayesian Elastic Net and Extended FP-Growth Approach
          </p>
        </div>
        <div className="flex items-center gap-4">
          {/* Supervisor Icon */}
          <button
            className="focus:outline-none"
            title="Supervisor Login"
            onClick={() => setShowSupervisor(true)}
          >
            <span className="text-3xl">üßë‚Äçüè´</span>
          </button>
          {/* Admin Icon */}
          <button
            className="focus:outline-none"
            title="Admin Login"
            onClick={() => setShowAdmin(true)}
          >
            <span className="text-3xl">üë§</span>
          </button>
        </div>
      </header>

      <div className="max-w-6xl mx-auto px-6 py-10">
        {/* Main Progress Section */}
        <div className="text-center mb-16">
          {/* Robot Mascot with Speech Bubble */}
          <div className="flex justify-center items-center mb-8">
            <div className="relative">
              {/* Speech Bubble */}
              <div className="px-6 py-4 rounded-lg mb-4 max-w-sm bg-white border border-gray-200 shadow-none">
                <p className="font-bold text-black">
                  {translations[currentTranslation].emoji} {translations[currentTranslation].text}
                </p>
                <p className="text-sm text-gray-600 mt-1">
                  ({translations[currentTranslation].lang})
                </p>
              </div>
              {/* Robot */}
              <div className="w-24 h-24 bg-gradient-to-br from-orange-400 to-orange-600 rounded-lg flex items-center justify-center mx-auto">
                <div className="text-3xl">ü§ñ</div>
              </div>
            </div>
          </div>

          {/* Big Progress Bar */}
          <div className="bg-white rounded-2xl p-12 mb-8">
            <h2 className="text-4xl font-black text-black mb-8">Research Progress</h2>
            {/* Progress Display */}
            <div className="mb-8">
              <div className="text-8xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-orange-600 mb-4">
                {progress}%
              </div>
              {/* Progress Bar */}
              <div className="relative w-full h-8 bg-gray-200 rounded-full overflow-hidden">
                <div
                  className="h-full bg-gradient-to-r from-orange-500 to-orange-600 transition-all duration-1000 ease-out"
                  style={{ width: `${progress}%` }}
                ></div>
                <div className="absolute inset-0 flex items-center justify-center">
                  <div className="text-black font-bold text-sm">
                    {progress > 50 ? `${progress}% Complete` : ''}
                  </div>
                </div>
              </div>
            </div>
            {/* Inspiration Message */}
            <div className="p-6 rounded-xl mb-8 bg-gradient-to-r from-orange-200 to-yellow-100">
              <p className="text-xl font-bold text-orange-900">
                {getInspirationMessage(progress)}
              </p>
            </div>
            {/* Refresh Button */}
            <button
              onClick={handleRefresh}
              disabled={refreshing}
              className="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-full font-bold text-lg transition-colors disabled:opacity-50 shadow-none"
              title="Refresh Data"
            >
              {refreshing ? (
                <span className="animate-spin inline-block mr-2">üîÑ</span>
              ) : (
                <span className="inline-block mr-2">üîÑ</span>
              )}
              Refresh
            </button>
          </div>
        </div>

        {/* NLP Quote Section */}
        <div className="bg-gradient-to-r from-orange-100 to-yellow-100 rounded-xl p-8 mb-8">
          <h3 className="text-2xl font-black text-black mb-4">üí° AI Wisdom</h3>
          <p className="text-lg text-gray-800 font-medium italic">
            {nlpQuotes[currentQuote]}
          </p>
        </div>

        {/* Public Messages - Animated Cards */}
        <div className="mb-8">
          <h3 className="text-3xl font-black text-black mb-6">üì¢ Latest Updates</h3>
          <div className="grid gap-6 md:grid-cols-2">
            {messages.map((message, index) => (
              <div
                key={message.id}
                className="bg-white rounded-xl p-6 transform hover:scale-105 transition-transform duration-300 border border-gray-200 shadow-none"
                style={{
                  animationDelay: `${index * 0.2}s`,
                  animation: 'slideInUp 0.6s ease-out forwards'
                }}
              >
                <p className="text-gray-800 font-medium mb-3">{message.text}</p>
                <div className="flex justify-between items-center text-sm text-gray-600">
                  <span className="font-bold">by {message.author}</span>
                  <span>{new Date(message.timestamp).toLocaleDateString()}</span>
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* Commit Timeline Section */}
        {showCommits && (
          <div className="bg-white rounded-xl p-8 mb-8">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-2xl font-black text-black">üïí Commit Timeline (Last 10 Days)</h3>
              <button
                onClick={() => setShowCommits(false)}
                className="text-black hover:text-gray-600 text-2xl font-bold"
              >
                ‚úï
              </button>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full border-collapse">
                <thead>
                  <tr>
                    <th className="text-left text-xs text-gray-500 font-bold pr-2">Day</th>
                    {Array.from({ length: 24 }, (_, h) => (
                      <th key={h} className="text-xs text-gray-400 font-normal px-1">{h}</th>
                    ))}
                  </tr>
                </thead>
                <tbody>
                  {commitGrid.map((row, dayIdx) => (
                    <tr key={dayIdx}>
                      <td className="text-xs text-gray-500 font-bold pr-2">
                        {getDayLabels()[dayIdx]}
                      </td>
                      {row.map((cell, hourIdx) => (
                        <td key={hourIdx} className="px-1 py-1">
                          <div
                            className="w-5 h-5 rounded-md cursor-pointer transition-transform duration-200 hover:scale-125"
                            style={{
                              background: getCellColor(cell.length),
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              fontSize: '10px',
                              color: '#222',
                              border: 'none',
                            }}
                            title={cell.length > 0 ? `${cell.length} commit(s)` : ''}
                            onClick={() => cell.length > 0 ? setExpandedCell({ day: dayIdx, hour: hourIdx }) : null}
                          >
                            {cell.length > 0 ? cell.length : ''}
                          </div>
                        </td>
                      ))}
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            {/* Expanded Cell Details */}
            {expandedCell && (
              <div className="mt-8">
                <h4 className="text-lg font-bold mb-2">
                  Commits on {getDayLabels()[expandedCell.day]}, Hour {expandedCell.hour}
                </h4>
                <div className="space-y-4">
                  {commitGrid[expandedCell.day][expandedCell.hour].map((commit, idx) => (
                    <div key={idx} className="bg-orange-50 rounded-lg p-4">
                      <div className="flex justify-between items-center">
                        <div>
                          <p className="font-bold text-orange-900 mb-1">{commit.commit.message.split('\n')[0]}</p>
                          <button
                            className="text-orange-600 hover:underline text-sm"
                            onClick={() => {
                              const el = document.getElementById(`desc-${commit.sha}`);
                              if (el) el.style.display = el.style.display === 'none' ? 'block' : 'none';
                            }}
                          >
                            {commit.commit.message.split('\n').length > 1 ? 'Show Description' : 'No Description'}
                          </button>
                          <div id={`desc-${commit.sha}`} style={{ display: 'none' }} className="mt-2 text-gray-700 text-xs">
                            {commit.commit.message.split('\n').slice(1).join('\n')}
                          </div>
                        </div>
                        <a
                          href={commit.html_url}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="bg-orange-500 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-orange-600"
                        >
                          View ‚Üí
                        </a>
                      </div>
                    </div>
                  ))}
                </div>
                <button
                  className="mt-4 text-orange-600 hover:underline text-sm"
                  onClick={() => setExpandedCell(null)}
                >
                  Close
                </button>
              </div>
            )}
          </div>
        )}

        {/* Show Commits Button */}
        <div className="text-center mb-12">
          <button
            onClick={fetchCommits}
            disabled={loading}
            className="bg-orange-500 hover:bg-orange-600 text-white px-8 py-4 rounded-full font-bold text-lg transition-colors disabled:opacity-50 shadow-none"
          >
            {loading ? 'Loading...' : 'üïí Show Commit Timeline'}
          </button>
        </div>

        {/* Footer */}
        <footer className="text-center py-8">
          <p className="text-xl font-bold text-black">üéì Thesis Progress Tracker ‚Ä¢ Built for Academic Excellence</p>
          <p className="text-gray-600 mt-2">Copyrights Batman of AI</p>
        </footer>
      </div>

      {/* Admin Modal */}
      {showAdmin && (
        <div className="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50">
          <div className="bg-white rounded-xl p-8 w-full max-w-sm">
            <h2 className="text-2xl font-bold mb-4">Admin Login</h2>
            <form action="/admin" method="POST">
              <input type="text" name="username" placeholder="Username" className="w-full mb-3 px-3 py-2 rounded border border-gray-300" />
              <input type="password" name="password" placeholder="Password" className="w-full mb-3 px-3 py-2 rounded border border-gray-300" />
              <button type="submit" className="w-full bg-orange-500 text-white py-2 rounded font-bold">Login</button>
            </form>
            <button className="mt-4 text-orange-600 hover:underline text-sm" onClick={() => setShowAdmin(false)}>Close</button>
          </div>
        </div>
      )}
      {/* Supervisor Modal */}
      {showSupervisor && (
        <div className="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50">
          <div className="bg-white rounded-xl p-8 w-full max-w-sm">
            <h2 className="text-2xl font-bold mb-4">Supervisor Login</h2>
            <form action="/notes-admin" method="POST">
              <input type="password" name="password" placeholder="Notes Admin Password" className="w-full mb-3 px-3 py-2 rounded border border-gray-300" />
              <button type="submit" className="w-full bg-orange-500 text-white py-2 rounded font-bold">Login</button>
            </form>
            <button className="mt-4 text-orange-600 hover:underline text-sm" onClick={() => setShowSupervisor(false)}>Close</button>
          </div>
        </div>
      )}

      <style>{`
        @keyframes slideInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `}</style>
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>